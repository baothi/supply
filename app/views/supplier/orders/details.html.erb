<% content_for :title, "Order-#{@order.number}" %>
<% content_for :main_menu, Hingeto::Section::ORDERS %>
<body class="animsition page-aside-static page-aside-left">
<%= render "shared/outdated_browser" %>
<%= render "shared/nav_bar" %>
<%= render "supplier/shared/side_menu" %>
<%= render "shared/grid_menu" %>

<div class="page">
  <div class="page-main">
    <div class="page-header">
      <h1 class="page-title">Order <%= @order.retailer_shopify_name %></h1>
    </div>


    <div class="page-content">
        <%= render :partial=>"shared/spaced_alerts" %>


      <div class="panel nav-tabs-horizontal" data-plugin="tabs">



        <div class="panel-body">
          <div class="row" style="padding-bottom:20px;">
            <div class="col-xs-12">
              <div class="text-xs-right">
                <% if @order.successfully_sent_order? %>
                  <% if @order.shipment_state != 'canceled' && @order.shipment_state != 'shipped' %>
                      <button type="button" class="btn btn-default btn-outline" data-target="#addTracking" data-toggle="modal">
                        <span><i class="icon fa-truck" aria-hidden="true"></i>Add Tracking</span>
                      </button>
                  <% end %>
                <% end %>

                <% if @order.shopify_order? && !@order.shipped? %>
                  <% if  @order.paid? && !@order.cancelled? %>
                    <%= link_to supplier_import_order_fulfillment_path(order_id: @order.internal_identifier) do %>
                      <button type="button" class="btn btn-primary btn-danger btn-dark">
                      <span><i class="icon fa-download" aria-hidden="true"></i>Fetch Tracking from Shopify</span>
                        </button>
                    <% end %>
                  <% end %>
                <% end %>

                &nbsp;&nbsp;
                <button type="button" class="btn btn-default btn-outline" onclick="javascript:window.print();">
                  <span><i class="icon fa-print" aria-hidden="true"></i>Print</span>
                </button>

                <% if @order.retailer_id == ENV['INTERNAL_RETAILER_ID'].to_i %>
                  <%= link_to retailer_remove_shipping_and_set_cost_path(order_id: @order.internal_identifier,  amount_in_cents: 1167) do %>
                    <button type="button" class="btn btn-success">
                      <span><i class="icon fa-print" aria-hidden="true"></i>Remove Shipping & Set all costs to $11.67</span>
                    </button>
                  <% end %>
                <% end %>

                <% if @order.retailer_id == ENV['INTERNAL_RETAILER_ID'].to_i %>
                    <%= link_to retailer_remove_shipping_and_set_cost_path(order_id: @order.internal_identifier, amount_in_cents: 1100) do %>
                        <button type="button" class="btn btn-success">
                          <span><i class="icon fa-print" aria-hidden="true"></i>Remove Shipping & Set all costs to $11</span>
                        </button>
                    <% end %>
                <% end %>

              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-lg-3 col-xs-12">
              <!--<h4>-->
                <!--<img class="m-r-10" src="../../assets//images/logo-blue.png" alt="...">Remark</h4>-->
              <!---->
              <% address = @order.shipping_address %>
              <address>
                <%= address.full_name %><br><%= address.address1 %><%= ", #{address.address2}" if address.address2.present? %>

                <br><%= address_full(@order.shipping_address) %>
                <br>
                <!--<abbr title="Mail">E-mail:</abbr>&nbsp;&nbsp;user@pacsundropship.com-->
                <abbr title="Phone">Phone:</abbr>&nbsp;&nbsp;<%= @order.shipping_address.phone %>
              </address>
            </div>
            <div class="col-xs-12 col-lg-3 offset-lg-6 text-xs-right">
              <span>Order Date: <%= @order.completed_at.strftime("%B %d, %Y") unless @order.completed_at.nil? %></span>
              <br>
              <span class="tag <%= shipping_status_tag_class(@order.shipment_state) %>"><%= translate_to_shopify_shipping_status(@order.shipment_state)  %></span>
              &nbsp;&nbsp;
              <% payment_state_display = @order.payment_state_display %>
              <span class="tag <%= tag_class(@order.paid?) %>"><%= payment_state_display.humanize unless payment_state_display.nil? %></span>

              <% if @order.paid? && @order.successfully_sent_order? && @order.order_issue_report.present? %>
                &nbsp;&nbsp;
                <% if @order.order_issue_report.resolved? %>
                  <% if @order.order_issue_report.declined? %>
                    <span class="tag tag-danger">Issue Reported | Declined</span>
                  <% else %>
                    <span class="tag tag-success">Issue Reported | Credited</span>
                  <% end %>
                <% else %>
                  <span class="tag tag-warning">Issue Reported | Pending Decision</span>
                <% end %>
              <% end %>


              <% if @order.in_remittance_process? && !@order.paid_and_fulfilled? %>
                <span class="tag tag-pill tag-warning">We are currently processing this order.</span>
              <% end %>

              <!-- <br>
              <span>Fulfill by Date: January 22, 2017</span> -->
              <br>
              <span>Tracking #: <%= @order.tracking_numbers %></span>
            </div>
          </div>
          <div class="page-invoice-table table-responsive">
            <%= render 'supplier/orders/line_items' %>
          </div>
          <div class="text-xs-right clearfix">
            <div class="pull-xs-right">
              <p>Sub - Total amount:
                <span><%= number_to_currency @order.total_cost_price_without_shipping %></span>
              </p>
              <!-- <p>Discounts:
                <span>$35</span>
              </p> -->
              <p>Shipping:
                <span><%= number_to_currency @order.total_shipping %></span>
              </p>
              <!-- <p>Shipping:
                <span>$35</span>
              </p> -->
              <p class="page-invoice-amount">Grand Total:
                <span><%= number_to_currency (@order.total_cost_price_with_shipping) %></span>
              </p>
              <% if @order.paid? %>
                <% if @order.total_discount.positive? %>
                  <p class="page-invoice-amount">Applied Discount:
                    <span><%= number_to_currency (@order.total_discount) %></span>
                  </p>
                <% end %>
                <p class="page-invoice-amount">Amount Paid:
                  <span><%= number_to_currency (@order.payment_total) %></span>
                </p>
              <% end %>
            </div>
          </div>

        </div>
      </div>

      <!-- Order Diagnosis -->
        <div class="row">
          <div class="col-xxl-9 col-xl-8 col-lg-12 col-xs-12">
            <%= render partial: "supplier/orders/report/details", locals: { issue_report: @order.order_issue_report } %>
          </div>
          <div class="col-xxl-3 col-xl-4 col-lg-12 col-xs-12">
            <!-- add buttons -->

            <% if @order.order_issue_report.present? && !@order.order_issue_report.try(:resolved?)   %>
              <%= render partial: "supplier/orders/report/actions" %>
            <% end %>

          </div>
        </div>
        <!-- End Order Diagnosis -->

    </div>

  </div>
  <%= render partial: "supplier/orders/report/approve_modal" %>
  <%= render partial: "supplier/orders/report/decline_modal" %>
</div>




<%= render "shared/platform/footer" %>
</body>

<div id="report-modal-base"></div>
<%= render "supplier/orders/shared/fulfillment_modal" %>