<% content_for :title, "WooComerce" %>
<% content_for :main_menu, Hingeto::Section::WOOCOMMERCE %>
<% content_for :inner_menu, Hingeto::Section::SEARCH %>
<body class="animsition page-aside-static page-aside-left">
<%= render "shared/outdated_browser" %>
<%= render "shared/nav_bar" %>
<%= render "retailer/shared/side_menu" %>
<%= render "shared/grid_menu" %>


<div class="page">
  <%#= render "retailer/products/shared/menu" %>
  <div class="page-main">
    <div class="page-header">
      <%= render "retailer/products/shared/credit_card_alert" %>

<div class='ajax-alert'>
      <%#= render :partial=>"shared/alerts" %>

    </div>
    <br/>
    </div>


    <div class="page-content">

      <%= render :partial=>"shared/spaced_alerts" %>

      <div class="panel">
        <div class="panel-heading">
          <%= @current_supplier %>
          <h3 class="panel-title">Search for products</h3>
        </div>
        <div class="panel-body">
          <%#= render "retailer/products/shared/search_bar" %>
          <%#= render "retailer/products/shared/list_without_algolia" %>
          <%#= paginate @products , theme: 'twitter-bootstrap-4' %>
          <%= form_tag supplier_word_press_update_product_path, remote: true do %>
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">name</th>
                  <th scope="col">price</th>
                  <th scope="col">image</th>
                  <th scope="col">
                    <div class="checkbox">
                      <input type="checkbox" id="selectAll">
                      <label for="selectAll"></label>
                    </div>
                  </th>
                  <th scope="col"><%= submit_tag "Update Product", class: "btn btn-success" %></th>
                </tr>
              </thead>
              <tbody>
                <% @woocommerce.each do |woo| %>
                    <tr>
                      <th scope="row"><%= woo['id'] %></th>
                      <td><%= woo['name'] %></td>
                      <td><%= woo['sale_price'] %></td>
                      <% woo['images'].first(5).each do |image| %>
                        <td>
                        <div class="text-center">
                          <img src="<%= image['src'] %>" class="img-fluid" alt="Responsive image">
                      </div></td>
                      <% end %>
                      <% unless current_supplier.products.present? %>
                      <%#= form_tag supplier_word_press_update_product_path do %>
                        <%= hidden_field_tag :woo_product, woo.to_json %>
                        <td><%= check_box_tag "product_id[]", woo['id']  %></td>
                        <td>
                          <%#= submit_tag "Update Product", class: "btn btn-success" %>
                        </td>
                      <% end %>
                      <%# end %>

                    </tr>
                <% end %>
              </tbody>
            </table>
          <% end %>

        </div>
      </div>
    </div>

  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function(){
  })
  $('div.panel-body form').on("submit",function(){
    url = $(this).attr('action');
    product_id = parseInt($('#product_id_').val());
    woo_product = $('#woo_product').val();
    console.log("product_id : ",product_id)
    console.log("woo_product : ",woo_product)

    $.ajax({
      type: "POST",
      url: url,
      data: { woocomerce: { product_id: product_id, woo_product:woo_product} },
      dataType: 'json',
      success: function(){
        console.log("111111")
      }
    });
  });
  $('#selectAll').click(function(e){
    var table= $(e.target).closest('table');
    $('td input:checkbox',table).prop('checked',this.checked);
  });

</script>
<%= render "shared/platform/footer" %>
</body>
